# .github/workflows/main.yml
name: idevicepair gui build

on:
  push:
    branches: ["main"]

env:
  BINARY_NAME: pair
  VERSION: 1.0.0
  ICON_PNG: icons/idevicepair.png

jobs:
  build-linux:
    name: Build AppImage (x86_64 & ARM64)
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Rust
        uses: actions-rs/toolchain@v1
        with:
          toolchain: stable
          components: rustfmt, clippy

      - name: Install FUSE and AppStream dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y libfuse2 appstream

      - name: Build binaries
        run: |
          cargo build --release --bin ${{ env.BINARY_NAME }} --target x86_64-unknown-linux-gnu
          cargo build --release --bin ${{ env.BINARY_NAME }} --target aarch64-unknown-linux-gnu

      - name: Build AppImages
        uses: AppImageCrafters/build-appimage-action@v1
        with:
          recipe: ".github/appimage-builder.yml"
        env:
          UPDATE_INFO: "gh-releases-zsync|${{ github.repository_owner }}|${{ github.repository }}|latest|*.AppImage.zsync"

      - name: Upload AppImages
        uses: actions/upload-artifact@v4
        with:
          name: appimages
          path: "out/*.AppImage"


app: idevicepair
version: 1.0.0

sources:
  - type: dir
    path: target/x86_64-unknown-linux-gnu/release
    include:
      - pair
  - type: dir
    path: target/aarch64-unknown-linux-gnu/release
    include:
      - pair

appdir:
  path: AppDir

icon: idevicepair

desktop:
  Name: iDevicePair
  Exec: pair
  Icon: idevicepair
  Categories:
    - Utility

files:
  - source: icons/idevicepair.png
    destination: usr/share/icons/hicolor/256x256/apps/idevicepair.png